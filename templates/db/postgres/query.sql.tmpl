-- Query
{{- range .Databases }}
    {{- if eq .Type "postgres" }}
        {{range .Models }}
            {{- if eq .Type "user" }}

-- {{ .Name | title }}
-- name: Get{{ .Name | singularize | title }}ById :one
SELECT * FROM {{ .Name }}
WHERE id = $1 LIMIT 1;

-- name: List{{ .Name | title }} :many
SELECT * FROM {{ .Name }}
ORDER BY created_at;

-- name: Create{{ .Name | singularize | title }} :one
INSERT INTO {{ .Name }} (
    first_name,
    last_name,
    username,
    email,
    password_hashed,
    password_salt,
    status,
    created_by,
    updated_by,
    deleted_by,
    created_at,
    updated_at,
    deleted_at,
) VALUES (
    $1, 
    $2,
    $3,
    $4,
    $5,
    $6,
    $7,
    $8,
    $9,
    $10,
    NOW(),
    NOW(),
    NOW(),
)
RETURNING *;

-- name: Update{{ .Name | singularize | title }} :one
UPDATE {{ .Name }}
SET 
    first_name = $2,
    last_name = $3,
    status = $4,
    updated_by = $5,
    updated_at = NOW()
WHERE id = $1
RETURNING *;

-- name: Delete{{ .Name | singularize | title }} :exec
DELETE FROM {{ .Name }}
WHERE id = $1;

            {{- else }}

-- {{ .Name | title }}
-- name: Get{{ .Name | singularize | title }}ById :one
SELECT * FROM {{ .Name }}
WHERE id = $1 LIMIT 1;

-- name: List{{ .Name | title }} :many
SELECT * FROM {{ .Name }}
ORDER BY created_at;

-- name: Create{{ .Name | singularize | title }} :one
INSERT INTO {{ .Name }} (
    {{- range .Properties }}
    {{ .Name }},
    {{- end }}
    created_by,
    updated_by,
    deleted_by,
    created_at,
    updated_at,
    deleted_at,
) VALUES (
    {{- range loop 1 (len .Properties | add 3) }}
    ${{ . }},
    {{- end }}
    NOW(),
    NOW(),
    NOW(),
)
RETURNING *;

-- name: Update{{ .Name | singularize | title }} :one
UPDATE {{ .Name }}
SET 
    first_name = $2,
    last_name = $3,
    status = $4,
    updated_at = NOW()
WHERE id = $1
RETURNING *;

-- name: Delete{{ .Name | singularize | title }} :exec
DELETE FROM {{ .Name }}
WHERE id = $1;

            {{- end }}
        {{- end }}
    {{- end }}
{{- end }}
